# DEV-lldp-topomon 系統使用說明書

> **版本**: 1.1  
> **最後更新**: 2025-12-13  
> **語言支援**: 繁體中文 / 簡體中文 / English

---

## 目錄

1. [系統概述](#1-系統概述)
2. [快速開始](#2-快速開始)
3. [功能說明](#3-功能說明)
   - [拓撲圖](#31-拓撲圖)
   - [設備管理](#32-設備管理)
   - [告警中心](#33-告警中心)
   - [群組管理](#34-群組管理)
   - [系統設定](#35-系統設定)
4. [進階功能](#4-進階功能)
5. [常見問題](#5-常見問題)

---

## 1. 系統概述

**DEV-lldp-topomon** 是一個基於 LLDP（Link Layer Discovery Protocol）的網路拓撲監控系統，提供：

- 🗺️ **即時拓撲圖** - 視覺化網路設備連接關係
- 📊 **設備監控** - CPU、記憶體、連接狀態監控
- 🚨 **智慧告警** - 級聯離線偵測與根本原因分析
- 👥 **群組管理** - 按區域/功能分組設備
- 🌐 **多語系介面** - 支援繁中/簡中/英文

### 技術架構

| 層級 | 技術 |
|-----|-----|
| 前端 | HTML5 + CSS3 + JavaScript (vis.js) |
| 後端 | Python FastAPI |
| 資料庫 | SQLite |
| 協定 | SNMP v2c (LLDP-MIB) |

---

## 2. 快速開始

### 2.1 系統需求

- Python 3.9+
- 現代瀏覽器 (Chrome, Firefox, Edge)
- 網路設備需支援 SNMP 和 LLDP

### 2.2 安裝步驟

```bash
# 1. 複製專案
git clone <repository-url>
cd DEV-lldp-topomon

# 2. 建立虛擬環境
python -m venv venv
.\venv\Scripts\activate  # Windows
source venv/bin/activate  # Linux/Mac

# 3. 安裝依賴
pip install -r requirements.txt

# 4. 初始化資料庫
python -c "from app.db import init_db; init_db()"

# 5. 啟動伺服器
uvicorn app.main:app --host 0.0.0.0 --port 8080
```

### 2.3 存取系統

開啟瀏覽器前往：`http://localhost:8080`

---

## 3. 功能說明

### 3.1 拓撲圖

拓撲圖是系統的核心功能，提供網路架構的視覺化呈現。

#### 視圖模式

| 模式 | 說明 |
|-----|-----|
| **總覽 (Overview)** | 顯示所有設備，自動佈局 |
| **完整地圖 (Full Map)** | 完整拓撲，可縮放平移 |
| **群組視圖 (Group View)** | 依群組篩選顯示設備 |

#### 設備圖示

| 圖示 | 類型 | 說明 |
|-----|-----|-----|
| 🟢 | 線上設備 | 正常運作中 |
| 🔴 | 離線設備 | 無法連接 |
| 🟡 | 警告狀態 | 效能指標偏高 |

#### 操作方式

- **點擊設備** → 顯示設備詳情面板
- **雙擊設備** → 開啟完整詳情彈窗（含階層資訊）
- **拖曳設備** → 調整設備位置
- **滾輪縮放** → 放大/縮小拓撲圖
- **右鍵拖曳** → 平移視圖

#### 設備詳情彈窗

雙擊設備後會顯示：

- **設備資訊**: IP 位址、類型、品牌、型號、韌體、CPU/記憶體使用率
- **上游設備**: 此設備連接的上層設備清單
- **下游設備**: 此設備管理的下層設備清單
- **活躍告警**: 與此設備相關的未解決告警

---

### 3.2 設備管理

進入 **設備 (Devices)** 頁面管理所有網路設備。

#### 設備列表功能

| 功能 | 說明 |
|-----|-----|
| **搜尋** | 依主機名稱或 IP 位址篩選 |
| **狀態篩選** | 線上 / 離線 / 未知 |
| **品牌篩選** | Cisco / HP / Juniper 等 |
| **排序** | 點擊表頭進行升降序排序 |
| **分頁** | 調整每頁顯示筆數 |

#### 新增設備

1. 點擊 **「+ 新增設備」** 按鈕
2. 填寫設備資訊：
   - **Hostname**: 設備名稱
   - **IP Address**: 管理 IP
   - **Vendor**: 設備品牌
   - **Device Type**: 設備類型 (Core/Distribution/Access/AP)
   - **SNMP Community**: SNMP 社群字串
   - **Alert Profile**: 告警設定檔
3. **Auto-discover neighbors** 選項：
   - ✅ 勾選：自動透過 LLDP 發現並新增鄰居設備
   - ❌ 不勾選：僅新增此設備
4. 點擊 **「儲存」**

#### 編輯/刪除設備

- **編輯**: 點擊設備列的 ✏️ 按鈕
- **刪除**: 點擊設備列的 🗑️ 按鈕

---

### 3.3 告警中心

進入 **告警 (Alerts)** 頁面查看系統告警。

#### 告警類型

| 類型 | 嚴重程度 | 說明 |
|-----|---------|-----|
| **設備離線** | Critical | 設備無法通過 SNMP 連接 |
| **CPU 過高** | Warning/Critical | CPU 使用率超過閾值 |
| **記憶體過高** | Warning/Critical | 記憶體使用率超過閾值 |
| **連結使用率過高** | Warning/Critical | 網路介面使用率超過閾值 |

#### 級聯離線偵測

系統會自動分析設備階層，判斷離線原因：

- **根本原因告警 (Root Cause)**: 標記為 `ROOT CAUSE`，表示此設備直接導致其他設備離線
- **受影響設備**: 因上游設備離線而無法連接的設備
- **抑制告警**: 已確認且暫時抑制通知的告警

#### 告警卡片分組

告警列表會自動分組顯示：

| 分組 | 說明 |
|-----|-----|
| 🔥 **根本原因告警** | 被識別為離線根因的告警，優先處理 |
| 🔕 **已抑制告警** | 已確認並暫時抑制通知的告警 |
| ⚠️ **一般告警** | 其他未分類的告警 |

---

#### 告警確認管理

告警確認是處理告警的主要方式，可記錄處理人員和原因。

##### 確認告警

1. 點擊告警卡片或告警詳情視窗中的 **「✓ Acknowledge」** 按鈕
2. 在彈出的確認視窗中填寫：
   - **確認原因** (必填): 描述處理狀況或計畫
   - **抑制通知時間** (選填): 設定暫時不再收到此告警的通知
3. 點擊 **「Confirm」** 完成確認

##### 通知抑制功能

確認告警時可選擇抑制通知：

| 抑制時間選項 | 說明 |
|-------------|-----|
| 不抑制 | 持續接收此告警通知 |
| 1 小時 | 抑制 1 小時內的重複通知 |
| 4 小時 | 抑制 4 小時內的重複通知 |
| 24 小時 | 抑制 24 小時內的重複通知 |
| 永久 | 永不再發送此告警通知 |

> 💡 **提示**: 抑制通知不會關閉告警，只是暫停通知。告警解決後仍會自動恢復。

##### 新增備註

對於已確認的告警，可以添加後續處理備註：

1. 開啟告警詳情視窗
2. 點擊 **「📝 Add Note」** 按鈕
3. 輸入備註內容
4. 備註會記錄在確認歷史中

---

#### 確認歷史管理

每個告警都有獨立的確認歷史記錄，可追蹤所有處理過程。

##### 查看歷史

1. 點擊告警卡片開啟詳情視窗
2. 在 **「✅ Acknowledge History」** 區塊查看所有歷史記錄

##### 歷史記錄內容

每筆記錄包含：
- **事件類型**: ACKNOWLEDGE（確認）、ADD_NOTE（備註）、EDIT（編輯）、DELETE（刪除）
- **時間戳記**: 操作時間
- **原因/內容**: 確認原因、備註內容或編輯說明
- **抑制狀態**: 若有設定抑制，顯示抑制到期時間

##### 編輯歷史記錄

1. 在歷史記錄項目中點擊 **「📝 Edit」** 按鈕
2. 在彈出的輸入視窗中修改內容
3. 點擊 **「Confirm」** 儲存

##### 刪除歷史記錄

1. 點擊 **「🗑️ Delete」** 按鈕
2. 輸入刪除原因（必填）
3. 選擇是否恢復通知（若原記錄有抑制設定）
4. 確認刪除

> ⚠️ **注意**: 刪除操作為軟刪除，記錄會被標記為「已刪除」並顯示刪除原因，但不會完全移除。

##### 恢復推播通知

若告警已被抑制通知，可手動恢復：

1. 在確認歷史區域找到抑制資訊
2. 點擊 **「▶️ Resume Notifications」** 按鈕
3. 確認恢復後，系統將重新發送此告警的通知

---

#### 告警詳情視窗

點擊告警卡片開啟詳情視窗，包含：

| 區塊 | 內容 |
|-----|-----|
| 🖥️ **設備** | 設備名稱、IP 位址 |
| 📋 **訊息** | 告警詳細訊息 |
| ⏰ **時間軸** | 觸發時間、當前狀態 |
| ✅ **確認歷史** | 所有確認和操作記錄 |

#### 告警操作總覽

| 操作 | 說明 |
|-----|-----|
| **確認告警** | 輸入原因並可選擇抑制通知時間 |
| **新增備註** | 為已確認告警添加處理備註 |
| **編輯記錄** | 修改歷史記錄內容 |
| **刪除記錄** | 軟刪除歷史記錄（保留刪除原因） |
| **恢復推播** | 取消通知抑制，恢復告警通知 |
| **查看詳情** | 開啟完整告警資訊視窗 |
| **前往拓撲** | 在拓撲圖中定位該設備 |

---

### 3.4 群組管理

進入 **群組 (Groups)** 頁面組織設備。

#### 建立群組

1. 點擊 **「+ 新增」** 按鈕
2. 填寫群組資訊：
   - **名稱**: 群組顯示名稱
   - **描述**: 選填說明
   - **父群組**: 建立階層結構
   - **顏色**: 在拓撲圖中的標識顏色
3. 點擊 **「儲存」**

#### 管理群組設備

1. 在左側選擇群組
2. 右側顯示該群組的設備清單
3. 可進行以下操作：
   - **移動設備**: 將設備移至其他群組
   - **移除設備**: 將設備從群組中移除

#### 群組視圖

在拓撲圖頁面選擇 **「群組視圖」**，可依群組篩選顯示設備。

---

### 3.5 系統設定

進入 **設定 (Settings)** 頁面配置系統。

#### 系統概覽

顯示當前系統狀態：
- 設備總數
- 活躍告警數
- 連結總數

#### SNMP 設定

| 設定項目 | 預設值 | 說明 |
|---------|-------|-----|
| 預設社群字串 | - | 未設定專屬社群的設備使用此值 |
| 輪詢間隔 | 60 秒 | 設備狀態更新頻率 (30-300秒) |
| SNMP 逾時 | 5 秒 | 單次 SNMP 請求逾時時間 |
| SNMP 重試 | 2 次 | 失敗後重試次數 |

#### 告警設定檔

管理告警閾值設定：

| 指標 | 警告閾值 | 嚴重閾值 |
|-----|---------|---------|
| CPU 使用率 | 80% | 95% |
| 記憶體使用率 | 85% | 95% |
| 連結使用率 | 70% | 90% |

**建立新設定檔**:
1. 點擊 **「+ 新增設定檔」**
2. 設定名稱和各項閾值
3. 點擊 **「儲存設定檔」**

#### 日誌匯出

支援將告警和事件傳送至外部系統：
- **Elasticsearch**: 支援 REST API 推送
- **Graylog (GELF)**: 支援 GELF 協定

#### 通知設定

| 設定 | 說明 |
|-----|-----|
| 瀏覽器通知 | 新告警時顯示桌面通知 |
| 聲音警報 | 嚴重告警時播放提示音 |

---

## 4. 進階功能

### 4.1 多語系介面

系統支援三種語言介面，可在設定頁面手動切換。

#### 支援語言

| 語言代碼 | 顯示名稱 |
|---------|---------|
| `en` | English |
| `zh-TW` | 繁體中文 |
| `zh-CN` | 简体中文 |

#### 切換語言

1. 進入 **設定 (Settings)** 頁面
2. 在 **「外觀設定」** 區塊找到 **「語言」** 選項
3. 從下拉選單選擇目標語言
4. 頁面會立即切換語言

> 💡 **提示**: 語言偏好會儲存在瀏覽器的 localStorage 中，下次訪問時自動套用。

#### 翻譯範圍

所有介面元素皆已翻譯，包括：
- 導覽選單（拓樸 / 設備 / 告警 / 群組 / 設定）
- 按鈕文字和標籤
- 表格標題
- 彈出視窗內容
- 動態訊息和提示

### 4.2 深色/淺色模式

系統支援深色模式（預設）和淺色模式。

#### 切換主題

1. 進入 **設定 (Settings)** 頁面
2. 在 **「外觀設定」** 區塊找到 **「主題」** 選項
3. 選擇 **「🌙 Dark」** 或 **「☀️ Light」**

### 4.3 SNMP 測試工具

設定頁面提供內建的 SNMP 測試工具，可在新增設備前先驗證連線。

#### SNMP 連線測試

1. 進入 **設定 (Settings)** 頁面的 **「SNMP Testing Tools」** 區塊
2. 填寫測試參數：
   - **Target IP**: 目標設備 IP
   - **Community String**: SNMP 社群字串
   - **OID**: 選擇要查詢的 OID（或自訂）
3. 點擊 **「SNMP Get」** 或 **「SNMP Walk」** 執行測試
4. 檢視測試結果

#### 可用 OID 選項

| OID | 說明 |
|-----|-----|
| sysDescr | 系統描述 |
| sysName | 主機名稱 |
| sysUpTime | 運行時間 |
| lldpRemTable | LLDP 鄰居表 |
| 自訂 OID | 輸入任意 OID |

#### 網段限制

可設定允許的 SNMP 測試目標網段：

1. 在 **「SNMP Settings」** 區塊填寫允許的網段（CIDR 格式）
2. 勾選 **「Enable Subnet Restriction」** 啟用限制
3. 超出範圍的 IP 將無法進行測試

### 4.4 手動設備探索

可手動觸發設備探索，無需在設備列表中逐一新增。

#### 使用方法

1. 在 **「Manual Device Discovery」** 區塊填寫：
   - **IP Address**: 起始設備 IP
   - **Community String**: SNMP 社群字串
2. 勾選 **「Recursive Discovery」** 啟用遞迴探索（自動發現 LLDP 鄰居）
3. 點擊 **「🔎 Start Discovery」**
4. 系統會顯示發現的設備清單，包括新增/已存在狀態

### 4.5 API 存取

系統提供 RESTful API，可透過程式化方式存取：

```
GET  /api/v1/devices          - 取得設備清單
GET  /api/v1/topology         - 取得拓撲資料
GET  /api/v1/alerts           - 取得告警清單
POST /api/v1/devices          - 新增設備
PUT  /api/v1/devices/{id}     - 更新設備
DELETE /api/v1/devices/{id}   - 刪除設備
```

API 文件：`http://localhost:8080/docs`

---

## 5. 常見問題

### Q1: 設備顯示離線但實際可連接？

**可能原因**:
1. SNMP 社群字串設定錯誤
2. 防火牆阻擋 SNMP 埠 (UDP 161)
3. 設備 SNMP 服務未啟用

**解決方法**:
1. 確認設備的 SNMP 設定
2. 檢查網路防火牆規則
3. 使用 `snmpwalk` 測試連線

### Q2: 拓撲圖沒有顯示連接線？

**可能原因**:
1. 設備未啟用 LLDP
2. LLDP 鄰居表尚未建立
3. 未執行自動發現

**解決方法**:
1. 確認設備已啟用 LLDP
2. 等待幾分鐘讓 LLDP 交換資訊
3. 重新執行設備發現

### Q3: 告警確認後仍顯示活躍？

**說明**: 確認告警只是標記已處理，並不會關閉告警。告警會在問題解決後自動轉為「已恢復」狀態。

### Q4: 如何備份資料？

**方法**: 備份專案目錄下的 `topology.db` 檔案即可保存所有設備和配置資料。

---

## 技術支援

如有問題，請聯繫系統管理員或查閱專案文件。

---

*© 2025 DEV-lldp-topomon. All rights reserved.*
